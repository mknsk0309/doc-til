# ステートの利用

## Props + Emit の問題点

親コンポーネントから子コンポーネントへデータを渡す `Props` と、子コンポーネントから親コンポーネントのイベント処理を呼び出すことでデータを渡す `Emit` を合わせて、**「Propsダウン、イベントアップ」**と言う。

しかし、単純な親子関係では有効だが、コンポーネント数が増え構造が複雑になると破綻する。

そこで、アプリケーション全体でデータを保持しておき、各コンポーネントはそこからデータを取得したり、そのデータを書き換えたりと言う仕組みが必要になる。

Vue では、これを実現する仕組みとして `Provide` と `Inject` がある。
あるいは、より本格的にデータを管理できるモジュールとして、`Pinia` と言うものがあり、Vue プロジェクト作成時に追加することも可能。

## Nuxt のステート管理

### インターフェースのインポート

各コンポーネントで利用されるインターフェースをエクスポートするファイルを作成する。

オートインポートの対象ではないため、スクリプトブロックの先頭でインポートする必要がある。

ただし、通常のインポート文ではなく、 `import type` が一般的。Vue では、インターフェースのような方定義をインポートする場合は、`import type` を推奨。

## ステートを用意する useState()

`useState()` を実行すると、Nuxt はそのデータをステートとして管理し、コンポーネントをまたいで利用できるリアクティブデータとして扱えるようになる。

`useState()` を利用するには、ステートとするデータをジェネリクスとして型指定する。

また、`useState()` には以下の引数が必要。

- 第１引数：ステート名
  - この名称でステートを識別する。
  - アプリケーション全体で一位となるようにする。

- 第２引数：ステートとして管理するデータの初期値を生成するアロー関数
  - アロー関数の戻り値のデータ型は、`useState()` 関数のジェネリクスに型指定したデータ型と同一になる。

```js
useState<ステートのデータ型>(
  ステート名,
  (): ステートのデータ型 => {
    ステートの初期値生成処理
    return ステートの初期値;
  }
);
```

## ステートの取得 useState()

用意されたステートを取得する際にも `useState()` を利用する。

```js
const ステートを格納する変数 = useState<ステートのデータ型>(ステート名);
```

取得したステートデータへのアクセスは `value` プロパティを使用する。

## ステートのデータ更新

ステートのデータを直接更新することで反映される。
