# コンポーネント間連携

## コンポーネントのオートインポート

- Nuxt は `components` フォルダ内のコンポーネントファイルを自動インポートされる。
- サブフォルダ内のコンポーネントも自動インポートされるが、その場合はタグ名が変わる。
- サブフォルダ内のコンポーネントファイル名には、サブフォルダ名を含めることが推奨されている。

### オートインポートの優先度

1. `components/PartsTheSupplement.vue`
2. `components/parts/PartsTheSupplement.vue`
3. `components/parts/TheSupplement.vue`
4. `components/wow/PartsTheSupplement.vue`

上記のファイルが存在する場合、`PartsTheSupplement` タグを記述した時に読み込まれる順序は `1 -> 2 ->  3` の順序。
なお、4 はサブフォルダ名が異なるため、読み込まれない。

## 親から子にデータを渡す Props

### 子コンポーネントの準備

1. 個々の `Prop` をメンバーとするインターフェースを定義する

    インターフェース名については、基本的に `Props` としておく。
    親コンポーネントから受け取りたいデータは `Props` インターフェースのプロパティとして定義しておく。

    ```js
    interface Props {
      id: number;
      name: string;
      email: string;
      points: number;
      note?: string;    // ?:省略可能なプロパティ
    }    
    ```

2. `defineProps()` 関数を実行する

    (1) で定義したインターフェースを `Props` として利用するために、`defineProps()` 関数を実行する。
    その際、`< >` 内に該当のインターフェースをジェネリクスとして方指定する。
    スクリプトブロック内で親から渡されたデータを利用したい場合は、`defineProps()` の戻り値を変数として受け取り、そのプロパティを利用する。

    ```js
    const props = defineProps<Props>();

    const localPoints = ref(props.points);
    const localNote = computed(
      (): string => {
        let localNote = props.note;
        if (localNote == undefined) {
          localNote = "--";
        }
        return localNote
      }
    );
    ```

### Props 利用時の注意

`Props` のデータは、読み取り専用のため直接変更はできない。
例えばポイントを加算したい時に、次のように加算できない。

```js
props.points++;
```

代わりに、`Props` の値をもとにこのコンポーネント専用のテンプレート変数を使用し、データの変更を行う。

### 親コンポーネントから子コンポーネントへ値を渡す

コンポーネントタグ内の属性として、各 `Props` を記述する。
ただし、テンプレート変数を `Props` 経由で渡す場合は `v-bind` ディレクティブを利用する。

```html
<子コンポーネント名
  v-bind:Prop名="テンプレート変数"
/>
```

## 子が親のイベントを実行する Emit

### Emit　の仕組みと流れ

子コンポーネントで `emit()` が実行されると、親コンポーネントのメソッドが実行される。

1. 親コンポーネントにおいて、子コンポーネントの `emit()` の第１引数の文字列と、個コンポーネントタグに記述した `v-on` ディレクティブの引数と一致するものを探す
2. 一致した `v-on` ディレクティブの属性値に注目する
3. 親コンポーネントのスクリプトブロックで、(2)と一致するメソッドを実行する

### Emit 利用のコーディングパターン

1. 親コンポーネントへの記述
   1. 処理メソッドの用意

      親コンポーネントに、子コンポーネントが `emit()` を実行したタイミングで実行する処理メソッドを定義する。
      `emit()` の第２引数以降のデータを受け取れるように同じく引数定義をしておく。

   2. `v-on` ディレクティブの記述

      親コンポーネントで、子コンポーネントを記述する際に、`v-on` ディレクティブを記述し、その属性値として前項で定義したメソッド名を記述する。
      `v-on` ディレクティブの引数は任意の文字列でよく、これをイベント名として子コンポーネントで使用する。

2. 子コンポーネントの記述
   1. `Emit` の定義

      子コンポーネント内で `Emit` を定義する。
      まず、`type` キーワードを利用して Emit の方定義を行う。型名は通常、`Emit` とする。
      定義内容は、前項で用意したイベント名をプロパティ名とするオブジェクト型。

      そのプロパティの値に**ラベル付きタプル**を記述する。
      このラベル付きタプルに、親コンポーネントにデータを渡すための引数を定義する。

      `Emit` の方を定義した後、`defineEmits()` を実行し、その際にジェネリクス型指定として、`Emits` 型を指定する。
      また、この `defineEmits()` の戻り値は、必ず変数として受け取る。

      ```js
      type Emits = {
        イベント名: [引数: データ型, ...];
        ...
      };
      const emit = defineEmits<Emits>();
      ```

   2. `Emit` の実行

      子コンポーネントで親コンポーネントのメソッドを実行したいタイミングで `emit()` を実行する。
      その際、第１引数として実行したいイベント名を渡す。第２引数以降は、定義されていれば渡す。
